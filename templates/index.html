<!DOCTYPE html>
<html>
<head>
    <title>ZImage Manager Edition</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root { --bg: #0f0f0f; --panel: #1a1a1a; --accent: #7209b7; --mode4k: #f72585; --mode8k: #00d2d3; --mode16k: #ffd32a; }
        body { background: var(--bg); color: #eee; font-family: 'Segoe UI', Tahoma, sans-serif; display: flex; margin: 0; height: 100vh; overflow: hidden; }
        
        .sidebar { width: 320px; background: var(--panel); padding: 20px; border-right: 1px solid #333; overflow-y: auto; display: flex; flex-direction: column; }
        .main { flex: 1; padding: 20px; display: flex; flex-direction: column; background: #050505; }
        
        h1 { font-family: Impact, sans-serif; color: var(--accent); margin: 0; font-size: 28px; letter-spacing: 1px; }
        .label { font-size: 10px; color: #888; font-weight: bold; margin-top: 15px; display: block; text-transform: uppercase; }
        
        textarea, input, select { width: 100%; background: #262626; border: 1px solid #333; color: white; padding: 10px; border-radius: 5px; margin-top: 5px; box-sizing: border-box; font-size: 13px; }
        textarea:focus { outline: 1px solid var(--accent); }
        
        .btn { width: 100%; padding: 12px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 10px; transition: 0.2s; }
        .btn-gen { background: var(--accent); color: white; font-size: 15px; }
        .btn-gen:hover { background: #560bad; }
        .btn-gen:disabled { background: #444; cursor: not-allowed; }
        .btn-gemini { background: #4fabff; color: black; }

        #image-container { flex: 1; margin-top: 15px; border: 1px solid #222; display: flex; align-items: center; justify-content: center; background: #000; position: relative; border-radius: 8px; overflow: hidden; }
        #preview { max-width: 100%; max-height: 100%; object-fit: contain; display: none; }
        
        .status-box { text-align: center; }
        .loader { color: var(--accent); font-weight: bold; font-size: 14px; margin-bottom: 10px; }
        .error-text { color: #ff4757; font-size: 13px; margin-top: 10px; display: none; }
        
        .mode-4k { color: var(--mode4k) !important; font-weight: bold; }
        .mode-8k { color: var(--mode8k) !important; font-weight: bold; }
        .mode-16k { color: var(--mode16k) !important; font-weight: bold; }
    </style>
</head>
<body>
    <div class="sidebar">
        <h1>ZIMAGE</h1>
        <div style="font-size: 9px; color: #666; margin-bottom: 10px;">MANAGER EDITION v2</div>
        
        <span class="label">Resolution Mode</span>
        <select id="quality">
            <option value="Standard">Standard</option>
            <option value="HD">Crystal (HD)</option>
            <option value="4K" class="mode-4k">âš¡ 4K ULTRA</option>
            <option value="8K" class="mode-8k">ðŸ§ª 8K EXPERIMENTAL</option>
            <option value="16K" class="mode-16k">â˜¢ 16K EXPERIMENTAL</option>
        </select>

        <span class="label">Aspect Ratio</span>
        <select id="ratio">
            <option value="1:1">1:1 Square</option>
            <option value="16:9">16:9 Cinematic</option>
            <option value="9:16">9:16 Portrait</option>
            <option value="4:3">4:3 TV</option>
            <option value="2:3">2:3 Classic</option>
        </select>

        <span class="label">Seed (-1 = Random)</span>
        <input type="text" id="seed" value="-1">

        <button class="btn btn-gemini" id="geminiBtn" onclick="enhance()">âœ¨ AI Enhance (Gemini)</button>
        
        <span class="label">Negative Prompt</span>
        <textarea id="negative" rows="3">ugly, blurry, low quality, watermark, text, deformed</textarea>
    </div>

    <div class="main">
        <textarea id="prompt" rows="4" placeholder="Describe the image you want to create..."></textarea>
        <button class="btn btn-gen" id="genBtn" onclick="generate()">âœ¨ GENERATE IMAGE</button>
        
        <div id="image-container">
            <div class="status-box">
                <div id="status" class="loader">READY</div>
                <div id="errorBox" class="error-text">Generation failed. Please try again.</div>
            </div>
            <img id="preview" src="">
        </div>
        <div id="info" style="font-size: 11px; color: #555; margin-top: 8px; text-align: center;"></div>
    </div>

    <script>
        async function enhance() {
            const promptInput = document.getElementById('prompt');
            const btn = document.getElementById('geminiBtn');
            if(!promptInput.value) return alert("Enter a basic prompt first!");
            
            btn.disabled = true;
            btn.innerText = "Thinking...";

            try {
                const res = await fetch('/enhance', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ prompt: promptInput.value })
                });
                const data = await res.json();
                if(data.enhanced) promptInput.value = data.enhanced;
            } catch(e) { console.error(e); }
            
            btn.disabled = false;
            btn.innerText = "âœ¨ AI Enhance (Gemini)";
        }

        async function generate() {
            const btn = document.getElementById('genBtn');
            const status = document.getElementById('status');
            const preview = document.getElementById('preview');
            const info = document.getElementById('info');
            const errorBox = document.getElementById('errorBox');

            const quality = document.getElementById('quality').value;
            const prompt = document.getElementById('prompt').value;
            
            if(!prompt) return alert("Please enter a prompt!");

            // UI Reset
            btn.disabled = true;
            errorBox.style.display = 'none';
            preview.style.display = 'none';
            status.style.display = 'block';
            status.innerText = "STARTING ZIMAGE ENGINE...";
            info.innerText = "";

            try {
                // 1. Request URL from Backend
                const res = await fetch('/generate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        prompt: prompt,
                        negative: document.getElementById('negative').value,
                        ratio: document.getElementById('ratio').value,
                        quality: quality,
                        seed: document.getElementById('seed').value
                    })
                });
                
                const data = await res.json();
                if(data.error) throw new Error(data.error);

                // 2. Display waiting message based on quality
                status.innerText = `DRAWING ${quality} IMAGE...\n(This usually takes 10-40 seconds)`;
                
                // 3. Set image src
                preview.src = data.image_url;

                // 4. Handle Success
                preview.onload = () => {
                    status.style.display = 'none';
                    preview.style.display = 'block';
                    btn.disabled = false;
                    info.innerText = `Seed: ${data.seed} | Res: ${data.dimensions} | Mode: ${quality}`;
                };

                // 5. Handle Failure (Timeout or Server Error)
                preview.onerror = () => {
                    status.style.display = 'none';
                    errorBox.style.display = 'block';
                    errorBox.innerText = "POLLINATIONS SERVER OVERLOADED. CLICK GENERATE AGAIN.";
                    btn.disabled = false;
                };

            } catch (err) {
                status.style.display = 'none';
                errorBox.style.display = 'block';
                errorBox.innerText = "ERROR: " + err.message;
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
